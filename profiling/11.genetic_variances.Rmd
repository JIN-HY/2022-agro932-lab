---
title: "Compute phenotypic values and variances"
author: "Jinliang Yang"
date: "02-24-2022"
output: pdf_document
---

## Path Normalization

````{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE) 
knitr::opts_knit$set(root.dir=normalizePath('..//')) 
#library(tidyverse)
```

--------------------------------

# Select for shorter plants

- Tom collected a population of 20 maize landraces to select short plants.
- Then phenotypically characterized the 20 landraces and selected two of them as the founder lines to make an F2 population.
- After phenotyping and genotyping, Tom needs to determine which individual plants be more valuable to be selected and crossed.

--

```{r, eval=FALSE}
d <- read.csv("data/soybean_half-sib_yield.csv")
#install.packages("tidyr")
library(tidyr)
df <- gather(d, key="Env", value="yield", 2:4)
```



```{r, eval=FALSE}
library(ggplot2)
ggplot(df, aes(x=yield, color=rep, fill=rep)) +
    geom_histogram(aes(y=..density..), position="identity", alpha=0.5)+
    geom_density(alpha=0.6)+
    facet_wrap(~ Env)+
    #scale_color_manual(values=c("#56B4E9", "#fe6f5e"))+
    labs(title="", y="Yield", x = "Density")+
    theme_classic() +
    guides(color=FALSE) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.y = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=18, face="bold"),
          )
```


```{r, eval=FALSE}
fit <- lm(yield ~ fam + Env + fam:Env + rep, data=df)
summary(aov(fit))
```


```{r, eval=FALSE}
out <- summary(aov(fit))[[1]]
vprogeny <- (out[1,3] - out[4,3])/(2*3)
```





```{r, eval=FALSE}
Va = 4/(1+1/2)*vprogeny
```



```{r, eval=FALSE}
Vp = 7.77/6
```

```{r, eval=FALSE}
h2 = vprogeny/(vprogeny + Vp)
```




```{r, eval=FALSE}
cc <- read.csv("data/ppj220030-sup-0002-tables1.csv")
table(cc$date)

### add replication information
cc$Rep <- "Rep2"
cc[cc$Row< 3000,] $Rep <- "Rep1"


j6 <- subset(cc, date %in% "July6")

fit <- lm(Canopy_Coverage ~ Genotype + Treatment + Genotype:Treatment + Rep, data=j6)
summary(aov(fit))
```




